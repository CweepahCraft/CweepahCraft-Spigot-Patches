From 0f3feff8814491482f238fc84c8fdd6ad63f03c6 Mon Sep 17 00:00:00 2001
From: Jacob Martin <jjm_223@hotmail.com>
Date: Mon, 13 Mar 2017 15:51:38 -0500
Subject: [PATCH] Implement time sync API


diff --git a/src/main/java/net/minecraft/server/WorldServer.java b/src/main/java/net/minecraft/server/WorldServer.java
index 669a9169..3a5faac3 100644
--- a/src/main/java/net/minecraft/server/WorldServer.java
+++ b/src/main/java/net/minecraft/server/WorldServer.java
@@ -303,7 +303,13 @@ public class WorldServer extends World implements IAsyncTaskHandler {
 
         this.worldData.setTime(this.worldData.getTime() + 1L);
         if (this.getGameRules().getBoolean("doDaylightCycle")) {
-            this.worldData.setDayTime(this.worldData.getDayTime() + 1L);
+            long newTime;
+            if (this.getWorld().hasTimeSync()) {
+                newTime = this.getWorld().getTimeSync().getTime();
+            } else {
+                newTime = this.worldData.getDayTime() + 1L;
+            }
+            this.worldData.setDayTime(newTime);
         }
 
         timings.doChunkUnload.stopTiming(); // Spigot
diff --git a/src/main/java/org/bukkit/craftbukkit/CraftWorld.java b/src/main/java/org/bukkit/craftbukkit/CraftWorld.java
index ef8165da..61ca409d 100644
--- a/src/main/java/org/bukkit/craftbukkit/CraftWorld.java
+++ b/src/main/java/org/bukkit/craftbukkit/CraftWorld.java
@@ -523,6 +523,22 @@ public class CraftWorld implements World {
         }
     }
 
+    // CweepahCraft start
+    private World timeSync;
+
+    public void setTimeSync(World timeSync) {
+        this.timeSync = timeSync;
+    }
+
+    public World getTimeSync() {
+        return this.timeSync;
+    }
+
+    public boolean hasTimeSync() {
+        return this.timeSync != null;
+    }
+    // CweepahCraft end
+
     public boolean createExplosion(double x, double y, double z, float power) {
         return createExplosion(x, y, z, power, false, true);
     }
-- 
2.17.0

