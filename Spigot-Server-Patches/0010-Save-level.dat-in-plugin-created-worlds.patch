From 37176f42a23d9babc6fa4973e43978eb70ca677e Mon Sep 17 00:00:00 2001
From: Jacob Martin <jjm_223@hotmail.com>
Date: Sat, 7 Jan 2017 14:19:08 -0600
Subject: [PATCH] Save level.dat in plugin-created worlds.


diff --git a/src/main/java/net/minecraft/server/WorldServer.java b/src/main/java/net/minecraft/server/WorldServer.java
index c891629b..669a9169 100644
--- a/src/main/java/net/minecraft/server/WorldServer.java
+++ b/src/main/java/net/minecraft/server/WorldServer.java
@@ -1084,15 +1084,13 @@ public class WorldServer extends World implements IAsyncTaskHandler {
         for (int j = 0; j < i; ++j) {
             WorldServer worldserver = aworldserver[j];
 
-            if (worldserver instanceof SecondaryWorldServer) {
-                ((SecondaryWorldServer) worldserver).c();
+            if (worldserver != null) {
+                worldserver.saveLevelData();
             }
         }
 
         // CraftBukkit start - Save secondary data for nether/end
-        if (this instanceof SecondaryWorldServer) {
-            ((SecondaryWorldServer) this).c();
-        }
+        saveLevelData();
         // CraftBukkit end
 
         this.worldData.a(this.getWorldBorder().getSize());
@@ -1435,6 +1433,10 @@ public class WorldServer extends World implements IAsyncTaskHandler {
         return this.getChunkProviderServer();
     }
 
+    private void saveLevelData() {
+        this.worldProvider.r();
+    }
+
     static class BlockActionDataList extends ArrayList<BlockActionData> {
 
         private BlockActionDataList() {}
-- 
2.17.0

