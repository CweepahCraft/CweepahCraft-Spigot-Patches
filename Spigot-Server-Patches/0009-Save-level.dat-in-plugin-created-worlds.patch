From 683f85e5a300ad440a272c08ad4c661d1c88fd02 Mon Sep 17 00:00:00 2001
From: Jacob Martin <jjm_223@hotmail.com>
Date: Sat, 7 Jan 2017 14:19:08 -0600
Subject: [PATCH 09/18] Save level.dat in plugin-created worlds.

---
 src/main/java/net/minecraft/server/WorldServer.java | 12 +++++++-----
 1 file changed, 7 insertions(+), 5 deletions(-)

diff --git a/src/main/java/net/minecraft/server/WorldServer.java b/src/main/java/net/minecraft/server/WorldServer.java
index 8afe1d3..660a358 100644
--- a/src/main/java/net/minecraft/server/WorldServer.java
+++ b/src/main/java/net/minecraft/server/WorldServer.java
@@ -1081,15 +1081,13 @@ public class WorldServer extends World implements IAsyncTaskHandler {
         for (int j = 0; j < i; ++j) {
             WorldServer worldserver = aworldserver[j];
 
-            if (worldserver instanceof SecondaryWorldServer) {
-                ((SecondaryWorldServer) worldserver).c();
+            if (worldserver != null) {
+                worldserver.saveLevelData();
             }
         }
 
         // CraftBukkit start - Save secondary data for nether/end
-        if (this instanceof SecondaryWorldServer) {
-            ((SecondaryWorldServer) this).c();
-        }
+        saveLevelData();
         // CraftBukkit end
 
         this.worldData.a(this.getWorldBorder().getSize());
@@ -1432,6 +1430,10 @@ public class WorldServer extends World implements IAsyncTaskHandler {
         return this.getChunkProviderServer();
     }
 
+    private void saveLevelData() {
+        this.worldProvider.r();
+    }
+
     static class BlockActionDataList extends ArrayList<BlockActionData> {
 
         private BlockActionDataList() {}
-- 
1.9.1

