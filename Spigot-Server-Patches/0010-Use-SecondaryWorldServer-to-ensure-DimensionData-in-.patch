From 7e73fd5714420b46598cb7085c1bc07eb4ce7168 Mon Sep 17 00:00:00 2001
From: Jacob Martin <jjm_223@hotmail.com>
Date: Sat, 7 Jan 2017 14:19:08 -0600
Subject: [PATCH 10/11] Use SecondaryWorldServer to ensure DimensionData in
 level.dat is saved.

---
 src/main/java/org/bukkit/craftbukkit/CraftServer.java | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/main/java/org/bukkit/craftbukkit/CraftServer.java b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
index 3f78a6e..5304853 100644
--- a/src/main/java/org/bukkit/craftbukkit/CraftServer.java
+++ b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
@@ -896,7 +896,9 @@ public final class CraftServer implements Server {
             worlddata = new WorldData(worldSettings, name);
         }
         worlddata.checkName(name); // CraftBukkit - Migration did not rewrite the level.dat; This forces 1.8 to take the last loaded world as respawn (in this case the end)
-        WorldServer internal = (WorldServer) new WorldServer(console, sdm, worlddata, dimension, console.methodProfiler, creator.environment(), generator).b();
+        WorldServer internal = (WorldServer) new SecondaryWorldServer(console, sdm, dimension,
+                ((CraftWorld) getWorlds().get(0)).getHandle(), console.methodProfiler, worlddata, creator.environment(),
+                generator).b();
 
         if (!(worlds.containsKey(name.toLowerCase(java.util.Locale.ENGLISH)))) {
             return null;
-- 
2.9.3

